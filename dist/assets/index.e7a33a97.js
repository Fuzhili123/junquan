import{D as be,r as T,c as U,E as xe,b as Be,G as Q,H as C,I as X,J as f,K as R,j as P,L as O,x as K,M as re,N as G,F as Ie,O as Me,P as $e,Q as Ne,R as Ce,y as ke,S as Te}from"./vendor.1464d7bc.js";import{r as pe,u as k}from"./utils.0eea1c46.js";import{T as M,D as _e,B as Fe,S as Ee,F as ze,C as Le,a as Ae,b as Re,c as Oe,L as Pe,d as Ve,P as qe,U as He,e as Je,f as je,g as Ue}from"./vant.377d2ced.js";const We=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}};We();const Ye="modulepreload",me={},Ke="/",ue=function(e,o){return!o||o.length===0?e():Promise.all(o.map(t=>{if(t=`${Ke}${t}`,t in me)return;me[t]=!0;const a=t.endsWith(".css"),s=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const r=document.createElement("link");if(r.rel=a?"stylesheet":Ye,a||(r.as="script",r.crossOrigin=""),r.href=t,document.head.appendChild(r),a)return new Promise((c,m)=>{r.addEventListener("load",c),r.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>e())};class Ge{constructor(){this.dbName="ForestManagementDB",this.dbVersion=1,this.storeName="forestData",this.db=null}async initDB(){return new Promise((e,o)=>{const t=indexedDB.open(this.dbName,this.dbVersion);t.onerror=()=>o(t.error),t.onsuccess=()=>{this.db=t.result,e(this.db)},t.onupgradeneeded=a=>{const s=a.target.result;if(!s.objectStoreNames.contains(this.storeName)){const r=s.createObjectStore(this.storeName,{keyPath:"id"});r.createIndex("sheetName","sheetName",{unique:!1}),r.createIndex("timestamp","timestamp",{unique:!1})}}})}estimateDataSize(e){const o=JSON.stringify(e);return new Blob([o]).size}async smartSave(e,o){try{const a=this.estimateDataSize(e)/(1024*1024);console.log(`\u6570\u636E\u5927\u5C0F: ${a.toFixed(2)}MB`),console.log(`\u6570\u636E\u6761\u6570: ${e.length}`);let s;return a<2?(console.log("\u9009\u62E9localStorage\u5B58\u50A8"),s=await this.saveToLocalStorage(e,o)):(console.log("\u9009\u62E9IndexedDB\u5B58\u50A8"),s=await this.saveToIndexedDB(e,o)),console.log("\u5B58\u50A8\u7ED3\u679C:",s),s}catch(t){throw console.error("smartSave\u5931\u8D25:",t),t}}async saveToLocalStorage(e,o){try{const a=[];for(let s=0;s<e.length;s+=1e3)a.push(e.slice(s,s+1e3));return localStorage.setItem("forest_data_batches",JSON.stringify({totalBatches:a.length,totalCount:e.length,timestamp:Date.now(),storageType:"localStorage"})),a.forEach((s,r)=>{localStorage.setItem(`forest_data_batch_${r}`,JSON.stringify(s)),o&&o((r+1)/a.length*100)}),console.log(`\u6570\u636E\u5DF2\u4FDD\u5B58\u5230localStorage\uFF0C\u5171${a.length}\u4E2A\u6279\u6B21`),{success:!0,storageType:"localStorage",batchCount:a.length}}catch(t){return console.warn("localStorage\u4FDD\u5B58\u5931\u8D25\uFF0C\u5C1D\u8BD5\u4F7F\u7528IndexedDB:",t),this.saveToIndexedDB(e,o)}}async saveToIndexedDB(e,o){try{await this.initDB();const t=500,a=[];for(let s=0;s<e.length;s+=t)a.push(e.slice(s,s+t));console.log(`\u51C6\u5907\u4FDD\u5B58 ${a.length} \u4E2A\u6279\u6B21\u5230IndexedDB`),await this.clearIndexedDB(),await this.saveBatchToIndexedDB({id:"batch_info",totalBatches:a.length,totalCount:e.length,timestamp:Date.now(),storageType:"indexedDB"});for(let s=0;s<a.length;s++){const r={id:`batch_${s}`,data:a[s],batchIndex:s};await this.saveBatchToIndexedDB(r),o&&o((s+1)/a.length*100),s%10===0&&await new Promise(c=>setTimeout(c,10))}return console.log(`\u6570\u636E\u5DF2\u4FDD\u5B58\u5230IndexedDB\uFF0C\u5171${a.length}\u4E2A\u6279\u6B21`),{success:!0,storageType:"indexedDB",batchCount:a.length}}catch(t){return console.error("IndexedDB\u4FDD\u5B58\u5931\u8D25:",t),{success:!1,error:t.message}}}async saveBatchToIndexedDB(e){return new Promise((o,t)=>{const a=this.db.transaction([this.storeName],"readwrite"),r=a.objectStore(this.storeName).put(e);r.onsuccess=()=>{o()},r.onerror=()=>{t(r.error)},a.onabort=()=>{t(new Error("\u4E8B\u52A1\u88AB\u4E2D\u6B62"))},a.onerror=()=>{t(a.error)}})}async smartLoad(){const e=this.loadFromLocalStorage();return e||this.loadFromIndexedDB()}loadFromLocalStorage(){try{const e=localStorage.getItem("forest_data_batches");if(!e)return null;const o=JSON.parse(e);if(o.storageType!=="localStorage")return null;const t=[];for(let a=0;a<o.totalBatches;a++){const s=localStorage.getItem(`forest_data_batch_${a}`);if(s){const r=JSON.parse(s);t.push(...r)}}if(t.length>0)return console.log(`\u4ECElocalStorage\u52A0\u8F7D\u4E86${t.length}\u6761\u6570\u636E`),{data:t,storageType:"localStorage",info:o}}catch(e){console.error("\u4ECElocalStorage\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}return null}async loadFromIndexedDB(){try{await this.initDB();const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),t=await new Promise((s,r)=>{const c=o.get("batch_info");c.onsuccess=()=>s(c.result),c.onerror=()=>r(c.error)});if(!t||t.storageType!=="indexedDB")return null;const a=[];for(let s=0;s<t.totalBatches;s++){const r=await new Promise((c,m)=>{const g=o.get(`batch_${s}`);g.onsuccess=()=>c(g.result),g.onerror=()=>m(g.error)});r&&r.data&&a.push(...r.data)}if(a.length>0)return console.log(`\u4ECEIndexedDB\u52A0\u8F7D\u4E86${a.length}\u6761\u6570\u636E`),{data:a,storageType:"indexedDB",info:t}}catch(e){console.error("\u4ECEIndexedDB\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",e)}return null}async clearIndexedDB(){try{await this.initDB();const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName);await new Promise((t,a)=>{const s=o.clear();s.onsuccess=()=>t(),s.onerror=()=>a(s.error)})}catch(e){console.error("\u6E05\u9664IndexedDB\u5931\u8D25:",e)}}async clearAll(){try{const e=localStorage.getItem("forest_data_batches");if(e){const o=JSON.parse(e);for(let t=0;t<o.totalBatches;t++)localStorage.removeItem(`forest_data_batch_${t}`)}localStorage.removeItem("forest_data_batches")}catch(e){console.error("\u6E05\u9664localStorage\u5931\u8D25:",e)}await this.clearIndexedDB(),console.log("\u6240\u6709\u5B58\u50A8\u6570\u636E\u5DF2\u6E05\u9664")}async getStorageInfo(){const e=this.getLocalStorageInfo(),o=await this.getIndexedDBInfo();return{localStorage:e,indexedDB:o,currentStorage:e?"localStorage":o?"indexedDB":"none"}}getLocalStorageInfo(){try{const e=localStorage.getItem("forest_data_batches");if(!e)return null;const o=JSON.parse(e);if(o.storageType!=="localStorage")return null;let t=e.length;for(let a=0;a<o.totalBatches;a++){const s=localStorage.getItem(`forest_data_batch_${a}`);s&&(t+=s.length)}return{...o,size:t,sizeMB:(t/(1024*1024)).toFixed(2)}}catch{return null}}async getIndexedDBInfo(){try{await this.initDB();const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName),t=await new Promise((a,s)=>{const r=o.get("batch_info");r.onsuccess=()=>a(r.result),r.onerror=()=>s(r.error)});return!t||t.storageType!=="indexedDB"?null:{...t,sizeMB:"\u8BA1\u7B97\u4E2D..."}}catch{return null}}}var ne=new Ge;const Qe=be("forestData",()=>{const n=T([]),e=T([]),o=T(!1),t=T({forestFarm:"",forestTeam:"",smallClass:"",renewalMethod:"",renewalYear:"",operationArea:"",operationContent:"",accountingItem:"",operator:"",acceptancePerson:"",completionDate:"",acceptanceDate:"",remarks:""}),a=U(()=>n.value.length),s=U(()=>e.value.length),r=U(()=>({forestFarms:[...new Set(n.value.map(l=>l.\u6797\u573A).filter(Boolean))],forestTeams:[...new Set(n.value.map(l=>l.\u6797\u961F).filter(Boolean))],smallClasses:[...new Set(n.value.map(l=>l.\u5C0F\u73ED).filter(Boolean))],renewalMethods:[...new Set(n.value.map(l=>l.\u66F4\u65B0\u65B9\u5F0F).filter(Boolean))],renewalYears:[...new Set(n.value.map(l=>l.\u66F4\u65B0\u5E74\u5EA6).filter(Boolean))],operationContents:[...new Set(n.value.map(l=>l.\u4F5C\u4E1A\u5185\u5BB9).filter(Boolean))],accountingItems:[...new Set(n.value.map(l=>l.\u5F55\u8D26\u9879\u76EE).filter(Boolean))],operators:[...new Set(n.value.map(l=>l.\u4F5C\u4E1A\u4EBA).filter(Boolean))],acceptancePersons:[...new Set(n.value.map(l=>l.\u9A8C\u6536\u4EBA).filter(Boolean))]})),c=(l,u)=>new Promise((p,w)=>{const B=new FileReader;B.onload=async y=>{try{u&&u(10);const N=new Uint8Array(y.target.result);u&&u(20);const Z=pe(N,{type:"array",cellDates:!1,cellNF:!1,cellStyles:!1}),F=Z.SheetNames,d=[];for(let h=0;h<F.length;h++){const b=F[h];try{const ee=20+h/F.length*60;u&&u(ee);const E=Z.Sheets[b],q=k.decode_range(E["!ref"]||"A1:A1"),D=Math.min(q.e.r+1,5e4),te=1e3;let he=0;const we=k.encode_range({s:{c:0,r:3},e:{c:q.e.c,r:3}}),De={...E,"!ref":we},fe=k.sheet_to_json(De,{header:1,defval:"",raw:!1});let H=fe.length>0?fe[0]:[];const ge=v=>v==null?"":String(v).replace(/\s+/g,"").trim();H=H.map(ge),console.log(`\u5DE5\u4F5C\u8868 ${b} \u7684\u5217\u6807\u9898(\u5DF2\u89C4\u8303\u5316):`,H);const ce=((v,oe)=>{const z=["\u6797\u573A","\u6797\u961F","\u5C0F\u73ED","\u66F4\u65B0\u65B9\u5F0F","\u66F4\u65B0\u5E74\u5EA6","\u4F5C\u4E1A\u9762","\u4F5C\u4E1A\u5185\u5BB9","\u4F5C\u4E1A\u4EBA"];let J=3,j=0;for(let L=0;L<Math.min(10,oe);L++){const ie=k.encode_range({s:{c:0,r:L},e:{c:q.e.c,r:L}}),de={...v,"!ref":ie},I=k.sheet_to_json(de,{header:1,defval:"",raw:!1});if(I.length>0){const A=I[0],S=z.filter(se=>A.some(Y=>Y&&Y.toString().includes(se))).length;console.log(`\u7B2C${L+1}\u884C\u5339\u914D\u5EA6: ${S}/${z.length}`,A),S>j&&(j=S,J=L)}}return console.log(`\u9009\u62E9\u7B2C${J+1}\u884C\u4F5C\u4E3A\u5217\u6807\u9898\u884C\uFF0C\u5339\u914D\u5EA6: ${j}/${z.length}`),J})(E,D);if(ce!==3){const v=k.encode_range({s:{c:0,r:ce},e:{c:q.e.c,r:ce}}),oe={...E,"!ref":v},z=k.sheet_to_json(oe,{header:1,defval:"",raw:!1});H.length=0;const J=z.length>0?z[0]:[];H.push(...J.map(ge)),console.log("\u6700\u7EC8\u5217\u6807\u9898(\u5DF2\u89C4\u8303\u5316):",H)}const ye=4;for(let v=ye;v<D;v+=te){const oe=Math.min(v+te,D),z=k.encode_range({s:{c:0,r:v},e:{c:q.e.c,r:oe-1}}),J={...E,"!ref":z},j=k.sheet_to_json(J,{header:1,defval:"",raw:!1});if(j.length>0)for(let I=0;I<j.length;I++){const A=j[I];if(A&&A.some(S=>S!=="")){const S={};H.forEach((se,Y)=>{se&&A[Y]!==void 0&&A[Y]!==""&&(S[se]=A[Y])}),Object.keys(S).length>0&&(S._id=`sheet_${h}_row_${v+I+1}`,S._sheetName=b,S._rowIndex=v+I+1,d.push(S),d.length<=3&&console.log(`\u793A\u4F8B\u6570\u636E ${d.length}:`,{\u884C\u53F7:v+I+1,\u6797\u573A:S.\u6797\u573A,\u6797\u961F:S.\u6797\u961F,\u5C0F\u73ED:S.\u5C0F\u73ED,\u4F5C\u4E1A\u5185\u5BB9:S.\u4F5C\u4E1A\u5185\u5BB9}))}}he+=te;const L=20+h/F.length*60,ie=he/D/F.length*20,de=Math.min(L+ie,100);u&&u(de),v%(te*10)===0&&await new Promise(I=>setTimeout(I,1))}}catch(ee){console.warn(`\u5904\u7406\u5DE5\u4F5C\u8868 ${b} \u65F6\u51FA\u9519:`,ee)}}u&&u(100),console.log("=== Excel\u89E3\u6790\u5B8C\u6210 ==="),console.log(`\u603B\u6570\u636E\u6761\u6570: ${d.length}`),console.log(`\u5DE5\u4F5C\u8868\u6570\u91CF: ${F.length}`),console.log("\u5DE5\u4F5C\u8868\u5217\u8868:",F);const i={};if(d.forEach(h=>{const b=h._sheetName;i[b]=(i[b]||0)+1}),console.log("\u5404\u5DE5\u4F5C\u8868\u6570\u636E\u91CF:",i),d.length>0){const h=d[0];console.log("\u6570\u636E\u5B57\u6BB5\u5217\u8868:",Object.keys(h).filter(b=>!b.startsWith("_"))),console.log("\u793A\u4F8B\u6570\u636E\u5B57\u6BB5:",{\u6797\u573A:h.\u6797\u573A,\u6797\u961F:h.\u6797\u961F,\u5C0F\u73ED:h.\u5C0F\u73ED,\u4F5C\u4E1A\u5185\u5BB9:h.\u4F5C\u4E1A\u5185\u5BB9,\u4F5C\u4E1A\u4EBA:h.\u4F5C\u4E1A\u4EBA})}console.log("===================="),p(d)}catch(N){console.error("Excel\u89E3\u6790\u5931\u8D25:",N),w(N)}},B.onerror=y=>{console.error("\u6587\u4EF6\u8BFB\u53D6\u5931\u8D25:",y),w(y)},B.readAsArrayBuffer(l)}),m=async(l,u)=>{o.value=!0;try{u&&u(5),await x(),n.value=[],e.value=[],console.log("\u5F00\u59CB\u89E3\u6790Excel\u6570\u636E...");const p=await c(l,B=>{const y=5+B*.75;u&&u(Math.min(y,80))});console.log(`Excel\u89E3\u6790\u5B8C\u6210\uFF0C\u5171\u89E3\u6790\u5230 ${p.length} \u6761\u6570\u636E`),p.length>1e5&&console.warn(`\u6570\u636E\u91CF\u8F83\u5927 (${p.length}\u6761)\uFF0C\u5EFA\u8BAE\u5206\u6279\u5904\u7406`),n.value=p,e.value=p,console.log("\u5F00\u59CB\u4FDD\u5B58\u6570\u636E\u5230\u5B58\u50A8..."),u&&u(85);const w=await ne.smartSave(p,B=>{const y=85+B*.15;u&&u(Math.min(y,100))});if(console.log("\u6570\u636E\u4FDD\u5B58\u7ED3\u679C:",w),w.success)console.log(`\u6570\u636E\u5DF2\u6210\u529F\u4FDD\u5B58\u5230 ${w.storageType}`);else throw console.error("\u6570\u636E\u4FDD\u5B58\u5931\u8D25:",w),new Error("\u6570\u636E\u4FDD\u5B58\u5931\u8D25");return u&&u(100),{success:!0,count:p.length,storageType:w.storageType}}catch(p){return console.error("Excel\u89E3\u6790\u5931\u8D25:",p),{success:!1,error:p.message}}finally{o.value=!1}},g=async()=>{try{const l=await ne.smartLoad();if(l&&l.data.length>0)return n.value=l.data,e.value=l.data,console.log(`\u4ECE${l.storageType}\u52A0\u8F7D\u4E86${l.data.length}\u6761\u6570\u636E`),{success:!0,storageType:l.storageType,count:l.data.length}}catch(l){console.error("\u4ECE\u5B58\u50A8\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",l)}return{success:!1}},x=async()=>{try{await ne.clearAll(),console.log("\u6240\u6709\u5B58\u50A8\u6570\u636E\u5DF2\u6E05\u9664")}catch(l){console.error("\u6E05\u9664\u5B58\u50A8\u5931\u8D25:",l)}},$=()=>{let l=[...n.value];Object.keys(t.value).forEach(u=>{const p=t.value[u];if(p){const w=String(p).toLowerCase().trim();if(w.length===0)return;l=l.filter(B=>{const y=le(u),N=B[y];return N==null?!1:String(N).toLowerCase().includes(w)})}}),e.value=l},V=()=>{t.value={forestFarm:"",forestTeam:"",smallClass:"",renewalMethod:"",renewalYear:"",operationArea:"",operationContent:"",accountingItem:"",operator:"",acceptancePerson:"",completionDate:"",acceptanceDate:"",remarks:""},e.value=n.value},W=(l=1,u=20)=>{const p=(l-1)*u,w=p+u;return{data:e.value.slice(p,w),total:e.value.length,page:l,pageSize:u,totalPages:Math.ceil(e.value.length/u)}},le=l=>({forestFarm:"\u6797\u573A",forestTeam:"\u6797\u961F",smallClass:"\u5C0F\u73ED",renewalMethod:"\u66F4\u65B0\u65B9\u5F0F",renewalYear:"\u66F4\u65B0\u5E74\u5EA6",operationArea:"\u4F5C\u4E1A\u9762\u79EF",operationContent:"\u4F5C\u4E1A\u5185\u5BB9",accountingItem:"\u5F55\u8D26\u9879\u76EE",operator:"\u4F5C\u4E1A\u4EBA",acceptancePerson:"\u9A8C\u6536\u4EBA",completionDate:"\u4F5C\u4E1A\u5B8C\u6210\u65E5\u671F",acceptanceDate:"\u9A8C\u6536\u65E5\u671F",remarks:"\u5907\u6CE8"})[l]||l;return{rawData:n,filteredData:e,loading:o,searchParams:t,totalCount:a,filteredCount:s,uniqueValues:r,loadExcelFile:m,searchData:$,resetSearch:V,getPaginatedData:W,parseExcelData:c,loadDataFromStorage:g,clearAllStorage:x}});class Xe{static async parseFile(e){return new Promise((o,t)=>{const a=new FileReader;a.onload=s=>{try{const r=new Uint8Array(s.target.result),c=pe(r,{type:"array"}),m=this.processWorkbook(c);o(m)}catch(r){t(r)}},a.onerror=t,a.readAsArrayBuffer(e)})}static processWorkbook(e){const o=[];return e.SheetNames.forEach(a=>{const s=e.Sheets[a],r=this.processWorksheet(s,a);o.push(...r)}),o}static processWorksheet(e,o){const t=k.sheet_to_json(e,{header:1}),a=[];if(t.length===0)return a;const s=this.normalizeHeaders(t[0]);for(let r=1;r<t.length;r++){const c=t[r];if(this.isValidRow(c)){const m=this.createDataItem(s,c,o,r);a.push(m)}}return a}static normalizeHeaders(e){return e.map(o=>typeof o=="string"?o.trim():String(o||"").trim())}static isValidRow(e){return!e||e.length===0?!1:e.some(o=>o!=null&&o!=="")}static createDataItem(e,o,t,a){const s={_id:`${t}_${a}`,_sheetName:t,_rowIndex:a};return e.forEach((r,c)=>{if(r&&o[c]!==void 0){const m=o[c];s[r]=this.normalizeValue(m)}}),s}static normalizeValue(e){if(e==null)return"";if(typeof e=="number")return e;if(typeof e=="string"){const o=e.trim(),t=parseFloat(o);return!isNaN(t)&&isFinite(t)?t:o}return e}static getFieldMapping(){return{\u6797\u573A:"forestFarm",\u6797\u961F:"forestTeam",\u5C0F\u73ED:"smallClass",\u66F4\u65B0\u65B9\u5F0F:"renewalMethod",\u66F4\u65B0\u5E74\u5EA6:"renewalYear",\u4F5C\u4E1A\u9762\u79EF:"operationArea",\u672C\u6279\u6B21\u7ED3\u7B97\u9762\u79EF:"settlementArea",\u4F5C\u4E1A\u5185\u5BB9:"operationContent",\u5F55\u8D26\u9879\u76EE:"accountItem",\u4F5C\u4E1A\u5B8C\u6210\u65E5\u671F:"completionDate",\u6295\u8D44\u6807\u51C6:"investmentStandard",\u5B9E\u9645\u6295\u8D44:"actualInvestment",\u4F5C\u4E1A\u4EBA:"operator",\u9A8C\u6536\u4EBA:"acceptancePerson",\u9A8C\u6536\u65E5\u671F:"acceptanceDate",\u672C\u5468\u671F\u5F00\u59CB\u65E5\u671F:"periodStartDate",\u672C\u5468\u671F\u7ED3\u675F\u65E5\u671F:"periodEndDate",\u5907\u6CE8:"remarks"}}static validateFile(e){const o=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],t=[".xlsx",".xls"],a=e.name.toLowerCase();return o.includes(e.type)||t.some(s=>a.endsWith(s))}}const Ze=()=>{const n=["\u5317\u5761\u65B0\u6751","\u5317\u5761\u65FA\u57FA","\u5317\u5761\u6E2F\u95E8","\u5357\u5C71\u6797\u573A","\u4E1C\u5C71\u6797\u573A"],e=["\u5317\u5761","\u5357\u5C71","\u4E1C\u5C71","\u897F\u6797","\u4E2D\u6797"],o=["\u65B0\u6751","\u65FA\u57FA\u5858","\u6E2F\u95E8","\u5357\u5C71001","\u4E1C\u5C71002","\u897F\u6797003","\u4E2D\u6797004"],t=["\u690D\u82D7","\u76F4\u64AD","\u5AC1\u63A5","\u6266\u63D2"],a=["\u6E05\u7406\u8FF9\u5730","\u4E0B\u6316\u6811\u5934\u76F4\u63A5\u5168\u57A6","\u673A\u5F00\u6C9F","\u673A\u7281\u8349\u5168\u57A6","\u673A\u5168\u57A6","\u4EBA\u5DE5\u6574\u5730","\u65BD\u80A5\u4F5C\u4E1A"],s=["\u9EC4\u5FB7\u751F","\u5983\u5C3E","\u9A6C\u59B9","\u8521\u5F6A","\u5F20\u4E09","\u674E\u56DB","\u738B\u4E94","\u8D75\u516D"],r=["\u5146\u4FE1\u674E\u79D1\u5F20\u5143","\u80E1\u5146\u4FE1\u5F20\u5143\u8F89","\u5146\u4FE1\u65E5\u65FA\u5F20\u5143","\u9A8C\u6536\u5458A","\u9A8C\u6536\u5458B"],c=[],m=[2015,2016,2017,2018,2019,2020];for(let g=0;g<100;g++){const x=m[Math.floor(Math.random()*m.length)],$=Math.round((Math.random()*500+10)*10)/10,V=Math.round(Math.random()*50+5),W=Math.round($*V*100)/100;c.push({_id:`demo_${g}`,_sheetName:"\u6574\u5730",_rowIndex:g+2,\u6797\u573A:n[Math.floor(Math.random()*n.length)],\u6797\u961F:e[Math.floor(Math.random()*e.length)],\u5C0F\u73ED:o[Math.floor(Math.random()*o.length)],\u66F4\u65B0\u65B9\u5F0F:t[Math.floor(Math.random()*t.length)],\u66F4\u65B0\u5E74\u5EA6:x,\u4F5C\u4E1A\u9762\u79EF:$,\u672C\u6279\u6B21\u7ED3\u7B97\u9762\u79EF:$,\u4F5C\u4E1A\u5185\u5BB9:a[Math.floor(Math.random()*a.length)],\u5F55\u8D26\u9879\u76EE:a[Math.floor(Math.random()*a.length)],\u4F5C\u4E1A\u5B8C\u6210\u65E5\u671F:`${x}.${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}.${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}`,\u6295\u8D44\u6807\u51C6:V,"\u6295\u8D44\u6807\u51C6.1":W,\u5B9E\u9645\u6295\u8D44:Math.round((V+Math.random()*2-1)*100)/100,"\u5B9E\u9645\u6295\u8D44.1":Math.round(W*(.95+Math.random()*.1)*100)/100,\u4F5C\u4E1A\u4EBA:s[Math.floor(Math.random()*s.length)],\u9A8C\u6536\u4EBA:r[Math.floor(Math.random()*r.length)],\u9A8C\u6536\u65E5\u671F:`${x}.${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}.${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}`,\u672C\u5468\u671F\u5F00\u59CB\u65E5\u671F:`${x-1}.12.20`,\u672C\u5468\u671F\u7ED3\u675F\u65E5\u671F:`${x}.01.20`,\u5907\u6CE8:g%3===0?"\u98CE\u5BB3\u7686\u4F10\u5C0F\u73ED":g%5===0?"\u5E76\u4E00\u4E2A\u73ED,1009-1\u539F\u662F\u519C\u7528\u5730\u4E0D\u7528\u6E05\u7406":""})}return c};var ve=(n,e)=>{const o=n.__vccOpts||n;for(const[t,a]of e)o[t]=a;return o};const et={class:"home-page"},tt={class:"stats-cards"},ot={class:"stat-card"},at={class:"stat-number"},st={class:"stat-card"},rt={class:"stat-number"},nt={class:"stat-card"},lt={class:"stat-number"},ct={class:"action-buttons"},it={key:0,class:"recent-searches"},dt={class:"search-list"},ut=["onClick"],ht={class:"search-title"},ft={class:"search-info"},gt={class:"upload-content"},mt={class:"upload-area"},pt={key:0,class:"upload-progress"},_t={class:"progress-info"},vt={class:"progress-text"},St={class:"progress-bar"},wt={class:"progress-percent"},Dt={__name:"Home",setup(n){const e=xe(),o=Qe(),t=T(!1),a=T([]),s=T(0),r=T([]),c=T(!1),m=T(!1),g=U(()=>o.totalCount),x=U(()=>o.filteredCount),$=U(()=>o.uniqueValues),V=U(()=>o.loading),W=()=>{e.push("/search")},le=()=>{e.push("/data-manage")},l=async d=>{if(!c.value)try{if(!Xe.validateFile(d.file)){M.fail("\u8BF7\u9009\u62E9\u6709\u6548\u7684Excel\u6587\u4EF6");return}if(d.file.size/(1024*1024)>50){M.fail("\u6587\u4EF6\u8FC7\u5927\uFF0C\u5EFA\u8BAE\u6587\u4EF6\u5927\u5C0F\u4E0D\u8D85\u8FC750MB");return}c.value=!0,m.value=!1,s.value=5;const h=await o.loadExcelFile(d.file,b=>{m.value||(s.value=b)});if(m.value){M("\u5BFC\u5165\u5DF2\u53D6\u6D88");return}h.success?(s.value=100,M.success(`\u6210\u529F\u5BFC\u5165${h.count}\u6761\u6570\u636E`),t.value=!1,a.value=[],y(h.count)):M.fail(`\u5BFC\u5165\u5931\u8D25: ${h.error}`)}catch(i){console.error("\u6587\u4EF6\u5904\u7406\u5931\u8D25:",i),M.fail("\u6587\u4EF6\u5904\u7406\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}finally{s.value=0,c.value=!1,m.value=!1}},u=()=>{if(a.value.length===0){M.fail("\u8BF7\u5148\u9009\u62E9\u6587\u4EF6");return}},p=()=>{m.value=!0,s.value=0,c.value=!1},w=()=>{const d=s.value;return d<=5?"\u6B63\u5728\u6E05\u9664\u65E7\u6570\u636E...":d<=90?"\u6B63\u5728\u89E3\u6790Excel\u6570\u636E...":d<=100?"\u6B63\u5728\u4FDD\u5B58\u6570\u636E...":"\u5904\u7406\u4E2D..."},B=()=>{_e.confirm({title:"\u786E\u8BA4\u6E05\u9664",message:"\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u6570\u636E\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002"}).then(async()=>{o.rawData=[],o.filteredData=[],await o.clearAllStorage(),localStorage.removeItem("forest_records"),r.value=[],M.success("\u6240\u6709\u6570\u636E\u5DF2\u6E05\u9664")}).catch(()=>{})},y=d=>{const i={id:Date.now(),timestamp:new Date,count:d,type:"import"},h=JSON.parse(localStorage.getItem("forest_records")||"[]");h.unshift(i),h.splice(10),localStorage.setItem("forest_records",JSON.stringify(h))},N=d=>new Date(d).toLocaleString("zh-CN"),Z=d=>{e.push({path:"/search",query:d.params})},F=async()=>{try{await o.clearAllStorage(),o.rawData=[],o.filteredData=[];const d=Ze();o.rawData=d,o.filteredData=d,await ne.smartSave(d),M.success(`\u6210\u529F\u52A0\u8F7D${d.length}\u6761\u6F14\u793A\u6570\u636E`),y(d.length)}catch(d){console.error("\u52A0\u8F7D\u6F14\u793A\u6570\u636E\u5931\u8D25:",d),M.fail("\u52A0\u8F7D\u6F14\u793A\u6570\u636E\u5931\u8D25")}};return Be(async()=>{const d=JSON.parse(localStorage.getItem("forest_records")||"[]");r.value=d.slice(0,5),await o.loadDataFromStorage()}),(d,i)=>{const h=Q("van-button"),b=Q("van-icon"),ee=Q("van-uploader"),E=Q("van-loading"),q=Q("van-dialog");return C(),X("div",et,[i[15]||(i[15]=f("div",{class:"header"},[f("h1",null,"\u68EE\u6797\u7BA1\u7406\u6570\u636E\u67E5\u8BE2\u7CFB\u7EDF"),f("p",{class:"subtitle"},"\u652F\u6301Excel\u6570\u636E\u5BFC\u5165\u548C\u79FB\u52A8\u7AEF\u67E5\u8BE2")],-1)),f("div",tt,[f("div",ot,[f("div",at,R(g.value),1),i[3]||(i[3]=f("div",{class:"stat-label"},"\u603B\u6570\u636E\u91CF",-1))]),f("div",st,[f("div",rt,R(x.value),1),i[4]||(i[4]=f("div",{class:"stat-label"},"\u7B5B\u9009\u7ED3\u679C",-1))]),f("div",nt,[f("div",lt,R($.value.forestFarms.length),1),i[5]||(i[5]=f("div",{class:"stat-label"},"\u6797\u573A\u6570\u91CF",-1))])]),f("div",ct,[P(h,{type:"primary",size:"large",icon:"search",onClick:W,class:"action-btn"},{default:O(()=>[...i[6]||(i[6]=[K(" \u6570\u636E\u67E5\u8BE2 ",-1)])]),_:1}),P(h,{type:"default",size:"large",icon:"upload",onClick:i[0]||(i[0]=D=>t.value=!0),class:"action-btn"},{default:O(()=>[...i[7]||(i[7]=[K(" \u5BFC\u5165Excel ",-1)])]),_:1}),g.value===0?(C(),re(h,{key:0,type:"success",size:"large",icon:"star",onClick:F,class:"action-btn"},{default:O(()=>[...i[8]||(i[8]=[K(" \u52A0\u8F7D\u6F14\u793A\u6570\u636E ",-1)])]),_:1})):G("",!0),g.value>0?(C(),re(h,{key:1,type:"info",size:"large",icon:"setting",onClick:le,class:"action-btn"},{default:O(()=>[...i[9]||(i[9]=[K(" \u6570\u636E\u7BA1\u7406 ",-1)])]),_:1})):G("",!0),g.value>0?(C(),re(h,{key:2,type:"warning",size:"large",icon:"delete",onClick:B,class:"action-btn"},{default:O(()=>[...i[10]||(i[10]=[K(" \u6E05\u9664\u6240\u6709\u6570\u636E ",-1)])]),_:1})):G("",!0)]),r.value.length>0?(C(),X("div",it,[i[11]||(i[11]=f("h3",null,"\u6700\u8FD1\u67E5\u8BE2",-1)),f("div",dt,[(C(!0),X(Ie,null,Me(r.value,D=>(C(),X("div",{key:D.id,class:"search-item",onClick:te=>Z(D)},[f("div",ht,R(D.title),1),f("div",ft,R(D.resultCount)+"\u6761\u7ED3\u679C \xB7 "+R(N(D.timestamp)),1)],8,ut))),128))])])):G("",!0),P(q,{show:t.value,"onUpdate:show":i[2]||(i[2]=D=>t.value=D),title:"\u5BFC\u5165Excel\u6570\u636E","show-cancel-button":!c.value,"show-confirm-button":!c.value,onConfirm:u,onCancel:p},{default:O(()=>[f("div",gt,[P(ee,{modelValue:a.value,"onUpdate:modelValue":i[1]||(i[1]=D=>a.value=D),"after-read":l,accept:".xlsx,.xls","max-count":1},{default:O(()=>[f("div",mt,[P(b,{name:"plus",size:"24"}),i[12]||(i[12]=f("p",null,"\u70B9\u51FB\u4E0A\u4F20Excel\u6587\u4EF6",-1)),i[13]||(i[13]=f("p",{class:"upload-tip"},"\u652F\u6301.xlsx\u548C.xls\u683C\u5F0F",-1))])]),_:1},8,["modelValue"]),s.value>0?(C(),X("div",pt,[P(E,{type:"spinner",size:"20"}),f("div",_t,[f("div",vt,R(w()),1),f("div",St,[f("div",{class:"progress-fill",style:$e({width:s.value+"%"})},null,4)]),f("div",wt,R(Math.round(s.value))+"%",1)]),P(h,{type:"danger",size:"small",onClick:p,disabled:!c.value},{default:O(()=>[...i[14]||(i[14]=[K(" \u53D6\u6D88 ",-1)])]),_:1},8,["disabled"])])):G("",!0)])]),_:1},8,["show","show-cancel-button","show-confirm-button"]),V.value?(C(),re(E,{key:1,type:"spinner",size:"24",class:"loading"})):G("",!0)])}}};var yt=ve(Dt,[["__scopeId","data-v-3db94db2"]]);const bt=[{path:"/",name:"Home",component:yt,meta:{title:"\u68EE\u6797\u7BA1\u7406\u6570\u636E\u67E5\u8BE2"}},{path:"/search",name:"Search",component:()=>ue(()=>import("./Search.c7cead65.js"),["assets/Search.c7cead65.js","assets/Search.6ae442a2.css","assets/vendor.1464d7bc.js","assets/vant.377d2ced.js","assets/utils.0eea1c46.js"]),meta:{title:"\u6570\u636E\u67E5\u8BE2"}},{path:"/detail/:id",name:"Detail",component:()=>ue(()=>import("./Detail.5bd075a2.js"),["assets/Detail.5bd075a2.js","assets/Detail.d494c6d9.css","assets/vendor.1464d7bc.js","assets/vant.377d2ced.js","assets/utils.0eea1c46.js"]),meta:{title:"\u8BE6\u7EC6\u4FE1\u606F"}},{path:"/data-manage",name:"DataManage",component:()=>ue(()=>import("./DataManage.5921c260.js"),["assets/DataManage.5921c260.js","assets/DataManage.2e6bb7bc.css","assets/vendor.1464d7bc.js","assets/vant.377d2ced.js","assets/utils.0eea1c46.js"]),meta:{title:"\u6570\u636E\u7BA1\u7406"}}],Se=Ne({history:Ce(),routes:bt});Se.beforeEach((n,e,o)=>{n.meta.title&&(document.title=n.meta.title),o()});const xt={name:"App"},Bt={id:"app"};function It(n,e,o,t,a,s){const r=Q("router-view");return C(),X("div",Bt,[P(r)])}var Mt=ve(xt,[["render",It]]);const ae={async listDatabases(){if("databases"in indexedDB)try{const n=await indexedDB.databases();return console.log("\u6240\u6709\u6570\u636E\u5E93:",n),n}catch(n){return console.error("\u83B7\u53D6\u6570\u636E\u5E93\u5217\u8868\u5931\u8D25:",n),[]}else return console.log("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301databases()\u65B9\u6CD5"),[]},async viewForestData(){return new Promise((n,e)=>{const o=indexedDB.open("forestDataDB",1);o.onerror=()=>{console.error("\u6253\u5F00\u6570\u636E\u5E93\u5931\u8D25:",o.error),e(o.error)},o.onsuccess=async()=>{const t=o.result;try{if(!t.objectStoreNames.contains("forestDataStore")){console.log("forestDataStore\u4E0D\u5B58\u5728"),n([]);return}const r=t.transaction(["forestDataStore"],"readonly").objectStore("forestDataStore").getAll();r.onsuccess=()=>{const c=r.result;if(console.log("IndexedDB\u4E2D\u7684\u6570\u636E:",c),console.log("\u6570\u636E\u6761\u6570:",c.length),c.length>0){const m=c.reduce((x,$)=>x+($.data?JSON.stringify($.data).length:0),0);console.log("\u6570\u636E\u5927\u5C0F:",this.formatSize(m));const g=c[0];g&&g.data&&g.data.length>0&&console.log("\u7B2C\u4E00\u4E2A\u6279\u6B21\u7684\u6570\u636E\u793A\u4F8B:",g.data.slice(0,3))}n(c)},r.onerror=()=>{console.error("\u83B7\u53D6\u6570\u636E\u5931\u8D25:",r.error),e(r.error)}}catch(a){console.error("\u64CD\u4F5C\u6570\u636E\u5E93\u5931\u8D25:",a),e(a)}t.close()}})},viewLocalStorage(){console.log("=== LocalStorage \u6570\u636E\u68C0\u67E5 ===");const n=localStorage.getItem("forest_data_single");if(n)try{const t=JSON.parse(n);console.log("forest_data_single \u6570\u636E:",t),console.log("forest_data_single \u6761\u6570:",t.length),console.log("forest_data_single \u5927\u5C0F:",this.formatSize(n.length))}catch(t){console.error("\u89E3\u6790forest_data_single\u5931\u8D25:",t)}else console.log("forest_data_single: \u65E0\u6570\u636E");const e=localStorage.getItem("forest_data_batches");if(e)try{const t=JSON.parse(e);console.log("forest_data_batches \u4FE1\u606F:",t);let a=0,s=0;for(let r=0;r<t.totalBatches;r++){const c=localStorage.getItem(`forest_data_batch_${r}`);c&&(a++,s+=c.length)}console.log("\u5B9E\u9645\u6279\u6B21\u6570\u91CF:",a),console.log("\u6279\u6B21\u6570\u636E\u603B\u5927\u5C0F:",this.formatSize(s))}catch(t){console.error("\u89E3\u6790forest_data_batches\u5931\u8D25:",t)}else console.log("forest_data_batches: \u65E0\u6570\u636E");const o=localStorage.getItem("forest_records");if(o)try{const t=JSON.parse(o);console.log("\u641C\u7D22\u5386\u53F2\u8BB0\u5F55:",t)}catch(t){console.error("\u89E3\u6790\u5386\u53F2\u8BB0\u5F55\u5931\u8D25:",t)}},formatSize(n){return n<1024?n+"B":n<1024*1024?(n/1024).toFixed(1)+"KB":(n/(1024*1024)).toFixed(1)+"MB"},async clearAllStorage(){console.log("=== \u6E05\u9664\u6240\u6709\u5B58\u50A8 ==="),localStorage.removeItem("forest_data_single"),localStorage.removeItem("forest_data_batches"),localStorage.removeItem("forest_records");for(let n=0;n<100;n++)localStorage.removeItem(`forest_data_batch_${n}`);console.log("LocalStorage\u5DF2\u6E05\u9664");try{const n=indexedDB.deleteDatabase("forestDataDB");n.onsuccess=()=>{console.log("IndexedDB\u5DF2\u6E05\u9664")},n.onerror=()=>{console.error("\u6E05\u9664IndexedDB\u5931\u8D25:",n.error)},n.onblocked=()=>{console.log("\u6E05\u9664IndexedDB\u88AB\u963B\u585E\uFF0C\u8BF7\u5173\u95ED\u5176\u4ED6\u6807\u7B7E\u9875")}}catch(n){console.error("\u6E05\u9664IndexedDB\u65F6\u51FA\u9519:",n)}},async fullCheck(){console.log("=== \u5B8C\u6574\u5B58\u50A8\u68C0\u67E5 ==="),console.log(`
1. \u68C0\u67E5LocalStorage:`),this.viewLocalStorage(),console.log(`
2. \u68C0\u67E5IndexedDB:`),await this.viewForestData(),console.log(`
3. \u68C0\u67E5\u6240\u6709\u6570\u636E\u5E93:`),await this.listDatabases()}};typeof window!="undefined"&&(window.indexedDBViewer=ae,window.viewForestData=()=>ae.viewForestData(),window.viewLocalStorage=()=>ae.viewLocalStorage(),window.clearAllStorage=()=>ae.clearAllStorage(),window.fullCheck=()=>ae.fullCheck(),console.log("IndexedDB\u67E5\u770B\u5DE5\u5177\u5DF2\u52A0\u8F7D\u5230window\u5BF9\u8C61"),console.log("\u53EF\u7528\u547D\u4EE4:"),console.log("- viewForestData() - \u67E5\u770BIndexedDB\u4E2D\u7684\u68EE\u6797\u6570\u636E"),console.log("- viewLocalStorage() - \u67E5\u770BLocalStorage\u4E2D\u7684\u6570\u636E"),console.log("- fullCheck() - \u5B8C\u6574\u68C0\u67E5\u6240\u6709\u5B58\u50A8"),console.log("- clearAllStorage() - \u6E05\u9664\u6240\u6709\u5B58\u50A8"));const _=ke(Mt);_.use(Fe);_.use(Ee);_.use(ze);_.use(Le);_.use(Ae);_.use(Re);_.use(Oe);_.use(Pe);_.use(Ve);_.use(qe);_.use(M);_.use(_e);_.use(He);_.use(Je);_.use(je);_.use(Ue);_.use(Te());_.use(Se);_.mount("#app");export{ve as _,ne as s,Qe as u};
