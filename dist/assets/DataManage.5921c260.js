import{E as F,r as _,c as g,b as J,G as m,H as x,I as E,j as l,J as h,L as r,M as A,N as K,x as f,K as $}from"./vendor.1464d7bc.js";import{_ as q,u as P,s as y}from"./index.e7a33a97.js";import{T as o,D as U}from"./vant.377d2ced.js";import"./utils.0eea1c46.js";const G={class:"data-manage-page"},H={class:"manage-content"},Q={class:"action-buttons"},W={class:"preview-content"},X={__name:"DataManage",setup(Y){const b=F(),c=P(),v=_(!1),p=_(""),w=_("unknown"),u=_({totalBatches:0,batchSize:1e3,timestamp:0}),S=g(()=>c.totalCount),B=g(()=>c.filteredCount),d=g(()=>c.uniqueValues),C=g(()=>u.value.timestamp?D(u.value.timestamp):"\u65E0\u6570\u636E"),k=g(()=>{var t;try{let e=0;for(let a=0;a<u.value.totalBatches;a++){const s=localStorage.getItem(`forest_data_batch_${a}`);s&&(e+=s.length)}return e+=((t=localStorage.getItem("forest_data_batches"))==null?void 0:t.length)||0,e<1024?e+"B":e<1024*1024?(e/1024).toFixed(1)+"KB":(e/(1024*1024)).toFixed(1)+"MB"}catch{return"\u8BA1\u7B97\u5931\u8D25"}}),z=()=>{b.back()},D=t=>t?new Date(t).toLocaleString("zh-CN"):"\u65E0",I=()=>{switch(w.value){case"localStorage":return"\u672C\u5730\u5B58\u50A8 (LocalStorage)";case"indexedDB":return"\u6D4F\u89C8\u5668\u6570\u636E\u5E93 (IndexedDB)";case"unknown":return"\u672A\u77E5";default:return"\u65E0\u6570\u636E"}},N=async()=>{try{o.loading("\u6B63\u5728\u68C0\u67E5IndexedDB...");const t=await y.smartLoad();if(t){const e={\u5B58\u50A8\u7C7B\u578B:t.storageType==="localStorage"?"\u672C\u5730\u5B58\u50A8":"\u6D4F\u89C8\u5668\u6570\u636E\u5E93",\u6570\u636E\u6761\u6570:t.data.length,\u6570\u636E\u5927\u5C0F:T(t.data),\u68C0\u67E5\u65F6\u95F4:new Date().toLocaleString("zh-CN")};p.value=JSON.stringify(e,null,2),v.value=!0,o.success("IndexedDB\u68C0\u67E5\u5B8C\u6210")}else o("\u672A\u627E\u5230\u5B58\u50A8\u7684\u6570\u636E")}catch(t){console.error("\u68C0\u67E5IndexedDB\u5931\u8D25:",t),o.fail("\u68C0\u67E5\u5931\u8D25: "+t.message)}},T=t=>{const e=new TextEncoder().encode(JSON.stringify(t)).length;return e<1024?e+"B":e<1024*1024?(e/1024).toFixed(1)+"KB":(e/(1024*1024)).toFixed(1)+"MB"},L=()=>{if(S.value===0){o("\u6682\u65E0\u6570\u636E");return}const t=c.rawData.slice(0,5).map((e,n)=>({\u5E8F\u53F7:n+1,\u6797\u573A:e.\u6797\u573A,\u6797\u961F:e.\u6797\u961F,\u5C0F\u73ED:e.\u5C0F\u73ED,\u4F5C\u4E1A\u5185\u5BB9:e.\u4F5C\u4E1A\u5185\u5BB9,\u4F5C\u4E1A\u4EBA:e.\u4F5C\u4E1A\u4EBA}));p.value=JSON.stringify(t,null,2),v.value=!v.value},M=()=>{if(S.value===0){o("\u6682\u65E0\u6570\u636E\u53EF\u5BFC\u51FA");return}try{const t=c.rawData,e=O(t),n=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),s=URL.createObjectURL(n);a.setAttribute("href",s),a.setAttribute("download",`\u68EE\u6797\u7BA1\u7406\u6570\u636E_${new Date().toISOString().slice(0,10)}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),o.success("\u6570\u636E\u5BFC\u51FA\u6210\u529F")}catch(t){console.error("\u5BFC\u51FA\u5931\u8D25:",t),o.fail("\u5BFC\u51FA\u5931\u8D25")}},O=t=>{if(t.length===0)return"";const e=Object.keys(t[0]),n=[];return n.push(e.join(",")),t.forEach(a=>{const s=e.map(i=>{const j=a[i]||"";return`"${String(j).replace(/"/g,'""')}"`});n.push(s.join(","))}),n.join(`
`)},R=async()=>{try{o.loading("\u6B63\u5728\u6D4B\u8BD5\u5B58\u50A8...");const t=[{\u540D\u79F0:"\u6D4B\u8BD51",\u6797\u573A:"\u6D4B\u8BD5\u6797\u573A",\u6797\u961F:"\u6D4B\u8BD5\u6797\u961F",\u5C0F\u73ED:"\u6D4B\u8BD5\u5C0F\u73ED"},{\u540D\u79F0:"\u6D4B\u8BD52",\u6797\u573A:"\u6D4B\u8BD5\u6797\u573A",\u6797\u961F:"\u6D4B\u8BD5\u6797\u961F",\u5C0F\u73ED:"\u6D4B\u8BD5\u5C0F\u73ED"}],e=await y.smartSave(t);console.log("\u4FDD\u5B58\u6D4B\u8BD5\u7ED3\u679C:",e);const n=await y.smartLoad();console.log("\u52A0\u8F7D\u6D4B\u8BD5\u7ED3\u679C:",n);const a={\u4FDD\u5B58\u7ED3\u679C:e,\u52A0\u8F7D\u7ED3\u679C:n?{\u5B58\u50A8\u7C7B\u578B:n.storageType,\u6570\u636E\u6761\u6570:n.data.length}:null,\u6D4B\u8BD5\u65F6\u95F4:new Date().toLocaleString("zh-CN")};p.value=JSON.stringify(a,null,2),v.value=!0,o.success("\u5B58\u50A8\u6D4B\u8BD5\u5B8C\u6210\uFF0C\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}catch(t){console.error("\u5B58\u50A8\u6D4B\u8BD5\u5931\u8D25:",t),o.fail("\u5B58\u50A8\u6D4B\u8BD5\u5931\u8D25: "+t.message)}},V=()=>{U.confirm({title:"\u786E\u8BA4\u6E05\u9664",message:"\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u6570\u636E\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002"}).then(async()=>{await c.clearAllStorage(),c.rawData=[],c.filteredData=[],o.success("\u6240\u6709\u6570\u636E\u5DF2\u6E05\u9664"),b.back()}).catch(()=>{})};return J(async()=>{try{const t=await y.smartLoad();t&&(w.value=t.storageType)}catch(t){console.error("\u68C0\u6D4B\u5B58\u50A8\u7C7B\u578B\u5931\u8D25:",t)}try{const t=localStorage.getItem("forest_data_batches");t&&(u.value=JSON.parse(t))}catch(t){console.error("\u83B7\u53D6\u6279\u6B21\u4FE1\u606F\u5931\u8D25:",t)}}),(t,e)=>{const n=m("van-nav-bar"),a=m("van-cell"),s=m("van-cell-group"),i=m("van-button");return x(),E("div",G,[l(n,{title:"\u6570\u636E\u7BA1\u7406","left-text":"\u8FD4\u56DE","left-arrow":"",onClickLeft:z}),h("div",H,[l(s,{title:"\u5B58\u50A8\u4FE1\u606F",inset:""},{default:r(()=>[l(a,{title:"\u603B\u6570\u636E\u91CF",value:S.value+"\u6761"},null,8,["value"]),l(a,{title:"\u7B5B\u9009\u7ED3\u679C",value:B.value+"\u6761"},null,8,["value"]),l(a,{title:"\u5B58\u50A8\u7C7B\u578B",value:I()},null,8,["value"]),l(a,{title:"\u5B58\u50A8\u65F6\u95F4",value:C.value},null,8,["value"]),l(a,{title:"\u5B58\u50A8\u5927\u5C0F",value:k.value},null,8,["value"])]),_:1}),l(s,{title:"\u6570\u636E\u7EDF\u8BA1",inset:""},{default:r(()=>[l(a,{title:"\u6797\u573A\u6570\u91CF",value:d.value.forestFarms.length},null,8,["value"]),l(a,{title:"\u6797\u961F\u6570\u91CF",value:d.value.forestTeams.length},null,8,["value"]),l(a,{title:"\u5C0F\u73ED\u6570\u91CF",value:d.value.smallClasses.length},null,8,["value"]),l(a,{title:"\u66F4\u65B0\u65B9\u5F0F",value:d.value.renewalMethods.length},null,8,["value"]),l(a,{title:"\u4F5C\u4E1A\u4EBA\u6570\u91CF",value:d.value.operators.length},null,8,["value"])]),_:1}),l(s,{title:"\u5B58\u50A8\u8BE6\u60C5",inset:""},{default:r(()=>[l(a,{title:"LocalStorage \u6279\u6B21",value:u.value.totalBatches+"\u4E2A"},null,8,["value"]),l(a,{title:"\u6BCF\u6279\u5927\u5C0F",value:u.value.batchSize+"\u6761"},null,8,["value"]),l(a,{title:"\u6700\u540E\u66F4\u65B0",value:D(u.value.timestamp)},null,8,["value"])]),_:1}),h("div",Q,[l(i,{type:"primary",size:"large",icon:"eye",onClick:L,class:"action-btn"},{default:r(()=>[...e[0]||(e[0]=[f(" \u9884\u89C8\u6570\u636E ",-1)])]),_:1}),l(i,{type:"info",size:"large",icon:"search",onClick:N,class:"action-btn"},{default:r(()=>[...e[1]||(e[1]=[f(" \u68C0\u67E5IndexedDB ",-1)])]),_:1}),l(i,{type:"success",size:"large",icon:"download",onClick:M,class:"action-btn"},{default:r(()=>[...e[2]||(e[2]=[f(" \u5BFC\u51FA\u6570\u636E ",-1)])]),_:1}),l(i,{type:"warning",size:"large",icon:"delete",onClick:V,class:"action-btn"},{default:r(()=>[...e[3]||(e[3]=[f(" \u6E05\u9664\u6570\u636E ",-1)])]),_:1}),l(i,{type:"default",size:"large",icon:"setting",onClick:R,class:"action-btn"},{default:r(()=>[...e[4]||(e[4]=[f(" \u6D4B\u8BD5\u5B58\u50A8 ",-1)])]),_:1})]),v.value?(x(),A(s,{key:0,title:"\u6570\u636E\u9884\u89C8",inset:""},{default:r(()=>[l(a,null,{title:r(()=>[h("div",W,[h("pre",null,$(p.value),1)])]),_:1})]),_:1})):K("",!0)])])}}};var le=q(X,[["__scopeId","data-v-1ca3962e"]]);export{le as default};
